<html>
<head>
	<title>Missing Votes: Do competitive districts inhibit democracy?</title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<link href='http://fonts.googleapis.com/css?family=Alike+Angular' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
	<style type="text/css">

	#wrapper{
		width:1000px;
		position:relative;
	}

	#headline{
		font-family: serif, Georgia;
		font-size: 30px;
	}

	.subhead{
		font-family: Helvetica, sans-serif;
		font-size: 15px;
		color:#666;
	}

	.paragraph{
		font-family: serif, Georgia;
		font-size: 14px;
		line-height: 1.3;
		width:650px;
		color:#666;
	}

	.side_label{
		font-family: sans-serif;
		text-transform: uppercase;
		font-size: 10px;
	}

	/*SCATTER PLOT CSS*/
	.xScatterAxis path, .xScatterAxis line {
    fill: none;
    shape-rendering: crispEdges;
	}

	.yScatterAxis line {
    fill: none;
    stroke: #E6E8FA;
    shape-rendering: crispEdges;

	}

	.yScatterAxis path {
		display: none;
	} 

	.xScatterAxis text {
    font-family: sans-serif;
    font-size: 11px;
	}

	.yScatterAxis text {
    font-family: sans-serif;
    font-size: 11px;
	}

	.scatterCircle{
		opacity:.7;
		fill:#236B8E;
	}

	.scatterCircle.highlight{
		stroke:#000;
		stroke-width:2px;
		fill:#236B8E;
		opacity: 1;
	}

	#scatter_drop{
		position:absolute;
		top:334px;
		left:800px;
	}

	#scatter_title{
    top: 270px;
    left: 581px;
    position: absolute;
    font-family: serif;
    color: 000;
    padding: 5px;
  }

  #scatter_y_label{
		top: 271px;
		position: absolute;
		left: 40px;
	}
	
	#scatter_x_label{
    padding-top:10px;
	}

	/*BIG BAR CHART CSS*/
	.bar{
		fill:#A8A8A8;
	}

	.swing{
		fill:#236B8E;
	}

	#big_bar_title{
    top: 799px;
    left: 646px;
    position: absolute;
    font-family: serif;
    color: 000;
    padding: 5px;
  }

  #big_bar_x_label{
  }

	/*SMALL CHART CSS*/
	.smallChart{
		width:200px;
		fill:none;
	}

	.ySmallFirst line {
    fill: none;
    stroke: #E6E8FA;
    shape-rendering: crispEdges;
	}

	.ySmallFirst path {
		display: none;
	} 

	.ySmallFirst text {
    font-family: sans-serif;
    font-size: 11px;
	}

	.ySmallAxis line {
    fill: none;
    stroke: #E6E8FA;
    shape-rendering: crispEdges;
	}

	.ySmallAxis path {
		display: none;
	} 

	.ySmallAxis text {
    font-family: sans-serif;
    font-size: 11px;
	}

	#ny_bar_title{
    top: 1609px;
    left: 243px;
    position: absolute;
	}

	#al_bar_title{
    top: 1609px;
    left: 471px;
    position: absolute;
	}

	#fl_bar_title{
    top: 1609px;
    left: 689px;
    position: absolute;
	}


	</style>
</head>
<body>
	<div id="wrapper" align="center">
			<div id="headline">Missing Votes: Do competitive districts inhibit democracy?</div>
			<div class="subhead">Legislators are often accused of campaigning while on the job, but does the assertion hold up?</div>
			<div class="paragraph">
					<p>The most basic function of our elected representatives is to vote on and enact legislation. But every year, due to a variety of reasons, <a href="http://www.sfgate.com/politics/article/Bay-Area-House-members-frequently-miss-votes-4803481.php">legislators miss votes</a>, sometimes important ones.</p>
					<p>Much has been said about congressmen abdicating their responsibilities while out stumping. <a href="http://abcnews.go.com/blogs/politics/2011/10/bachmann-breaks-streak-of-88-consecutive-missed-votes/"> Michele Bachmann missed almost 90 votes</a> while campaigning in 2012 and candidates often accuse their opponents of <a href="http://www.politifact.com/florida/statements/2012/oct/17/bill-nelson/bill-nelson-says-connie-mack-missed-lot-votes-year/">caring more about their reelections</a> than representing their constituents. 
					<p>Now that the campaigns for the 2014 elections are gaining steam, I took a look at this year's voting data to see if indeed legislators with the most incentives to campaign -- those in the most competitive districts --  were consistently missing votes in Congress. I wanted to see if this was a systemic problem, rather than something that happened on a district by district basis.</p>
			</div>
						
			<!-- MAIN BAR CHART --> 
			<div id="scatter_container"></div>
			<div id="scatter_title">Missed Vote Counts of Swing District Legislators</div>
			<div id="scatter_y_label" class="side_label">Missed Votes</div>
			<div id="scatter_x_label" class="side_label">Absolute Value of Romney-Obama Vote Share Differential</div>

			<div class="paragraph">
					<p>Your gut reaction to this chart is probably right: it doesn't show anything. There is essentially no correlation between the competitiveness of a district in the 2012 election and the amount of votes that the legislator from that district missed. Let's take a look at every legislator's voting record so far this year and see if there are any surprising revelations about swing districts.</p>
			</div>

			<!-- BIG BAR CHART -->
			<div id="big_bar_chart"></div>
			<div id="big_bar_title">Missed Vote Counts of All Legislators</div>
			<div id="big_bar_x_label"class="side_label">Legislators</div>

			<div class="paragraph">
					<p>Once again, nothing particularly stands out, other than some incredible absence totals by particular representatives. Swing districts are almost evenly spaced out throughout the spectrum of missed vote totals. What if we break it down by type of state? Maybe the political leaning of a state -- solidly Democrat, solidly Republican, and swing state -- might influence the behavior of legislators in competitive districts.</p>
			</div>

			<!-- SMALL BAR CHARTS -->
			<div id="small_bar_charts"></div>
			<div id="ny_bar_title" class="side_label">New York</div>
			<div id="al_bar_title" class="side_label">Alabama</div>
			<div id="fl_bar_title" class="side_label">Florida</div>

			<div class="paragraph" style="padding-top:25px;">
					<p>Even among states of different political leanings, there doesn't seem to be any particular correlation between more competitive districts and missed votes. Though, not unsurprisingly, the distribution of missed votes is fairly similar across all charts.</p>
			</div>

			<!-- SCATTER DROP DOWN MENU -->
			<div id="scatter_drop"></div>

					<script type="text/javascript">

							var margin = {top: 20, right: 10, bottom: 20, left: 20};

					    var width = 800 - margin.left - margin.right, height = 400 - margin.top - margin.bottom;

					    var scatterPlot = d3.select("#scatter_container").append("svg")
					    	.attr("width", width + margin.left + margin.right)
					      .attr("height", height+ margin.top + margin.bottom)
					      .append("g")
					      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					    var bigChartArea = d3.select("#big_bar_chart").append("svg")
					      .attr("width", width + margin.left + margin.right)
					      .attr("height", height + margin.top + margin.bottom)
					      .append("g")
					      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					    var smallChartArea1 = d3.select("#small_bar_charts").append("svg")
					      .attr("width", 200)
					      .attr("height", 300)
					      .attr("class","smallChart")
					      .append("g");

					     var smallChartArea2 = d3.select("#small_bar_charts").append("svg")
					      .attr("width", 200)
					      .attr("height", 300)
					      .attr("class","smallChart")
					      .append("g");

					     var smallChartArea3 = d3.select("#small_bar_charts").append("svg")
					      .attr("width", 200)
					      .attr("height", 300)
					      .attr("class","smallChart")
					      .append("g");

					    //LOADING DATA

					    d3.csv("assets/working_data2.csv", function(err,missed_votes_2013){

						    	missed_votes_2013.forEach(function(d){
						    		d.missed_votes = +d.missed_votes;
						    		d.diff12 = +d.diff12
						    	});

						    	var stateNames = [
						    		{ abbreviation:"CA", headline:"California"},
						    		{	abbreviation: "NY", headline:"New York"},
						    		{	abbreviation:"TX", headline:"Texas"}
						    		];

						    	//Running function to make scatter plot appear

						    	makeScatter();

						    	//Running function to make big chart appear
						    	bigChart();

						    	//temporarily running 3 functions for each state chart

						    	stateChart();

						    	/************************************
						    	stateNames.forEach(function(stateCode) {

							    	stateChart(stateCode);
						    		
						    	})
									***********************************/

									//SCATTER DROP-DOWN MENU

									var options = ['AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 'DC', 'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 'MI', 'MN', 'MO', 'MS', 'MT', 'NC', 'ND', 'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY']

									var scatterDrop = d3.select("#scatter_drop")
											.append("select");

									scatterDrop.selectAll("option")
											.data(options)
											.enter().append("option")
											.text(function(d) { return d; })

									scatterDrop.on("change",function(){
										var state = options[this.selectedIndex]
										d3.selectAll(".scatterCircle")
											.classed("highlight", false)
										d3.selectAll(".state-" + state)
											.classed("highlight", true)
									});

						    	function makeScatter() {

						    			//FILTERING DATA FOR JUST SWING DISTRICTS
						    			var scatterData = missed_votes_2013.filter(function(d){return isNaN(d.diff12) == false});

						    			//SCALES
						    			var xScale = d3.scale.linear()
									      .domain([0,d3.max(scatterData, function(d){return d.diff12;})])
									      .range([0,width])

									    var yScale = d3.scale.linear()
									    	.domain([0,d3.max(scatterData, function(d){return d.missed_votes;})])
										    .range([0,height])

										  var yAxisScale = d3.scale.linear()
								        .domain([0,d3.max(scatterData, function(d){return d.missed_votes;})])
								        .range([height,0])

										  var xAxisScale = d3.scale.linear()
								        .domain([0,d3.max(scatterData, function(d){return d.diff12;})])
								        .range([0,width])

											//AXES

					            var yAxis = d3.svg.axis()
					                .scale(yAxisScale)
					                .ticks(15)
					                .tickSize(-width - margin.left - margin.right)
					                .orient("left");

					            scatterPlot.append("g")
					                .call(yAxis)
					                .attr("class", "yScatterAxis")

					            var xAxis = d3.svg.axis()
					                .scale(xAxisScale)
					                .ticks(15)
					                .orient("bottom");

					            scatterPlot.append("g")
					                .call(xAxis)
					                .attr("transform", "translate(0," + (height) + ")")
					                .attr("class", "xScatterAxis")

										  scatterPlot.selectAll("circle")
										  	.data(scatterData)
										  	.enter()
										  	.append("circle")
										  	.attr("cx", function(d) {return Math.abs(xScale(d.diff12));})
										  	.attr("cy", function(d) {return height - yScale(d.missed_votes);})
										  	.attr("r", 3)
										  	.attr("class", function(d) { return "scatterCircle state-" + d.state; })


										  function updateScatter(state) {

              						var thisState = data.filter(function(d) { 
                							return d.state == state; 
              						});

              						d3.selectAll(".user-chosen-franchise")
		              						.transition()
		              						.attr("d", line(thisFranchise))
            					};

						    	};


						    	function bigChart() {

								    	//SCALES
								      var yScale = d3.scale.linear()
										    .domain([0,d3.max(missed_votes_2013, function(d){return d.missed_votes;})])
										    .range([0,height])

							        var axisScale = d3.scale.linear()
								        .domain([0,d3.max(missed_votes_2013, function(d){return d.missed_votes;})])
								        .range([height,0])

							        var xScale = d3.scale.linear()
									      .domain([0,missed_votes_2013.length])
									      .range([0,width])

											//AXES
					            var yAxis = d3.svg.axis()
					                .scale(axisScale)
					                .ticks(15)
					                .tickSize(-width - margin.left - margin.right)
					                .orient("left");

					            bigChartArea.append("g")
					                .call(yAxis)
					                .attr("class", "yScatterAxis")

					            var xAxis = d3.svg.axis()
					                .scale(xScale)
					                .ticks(15)
					                .orient("bottom");

									      

									    //DEFINING BAR CHART VARIABLE (CREATES TONS OF RECT ELEMENTS)
							        var bar = bigChartArea.selectAll(".bar")
							          .data(missed_votes_2013)
							          .enter().append("rect")
							          .attr("height", function(d) {return yScale(d.missed_votes);})
							          .attr("y", function(d){return height - yScale(d.missed_votes);})
							          .attr("width", 1)
							          .attr("x", function(d,i) {return 2*i})
							          .attr("class","bar")
							          .classed("swing",function(d){return d.swing == "TRUE"});

						    	};


						    	function stateChart() {

								    	var nyData = missed_votes_2013.filter(function(d){
								    			return d.state == "NY";
								    	});

								    	//SCALES
								      var yScale = d3.scale.linear()
										    .domain([0,d3.max(nyData, function(d){return d.missed_votes;})])
										    .range([0,300]);

							        var axisScale = d3.scale.linear()
								        .domain([0,d3.max(nyData, function(d){return d.missed_votes;})])
								        .range([300,0]);

							        var xScale = d3.scale.linear()
									      .domain([0, nyData.length])
									      .range([0,width]);

									    //AXES
					            var yAxis = d3.svg.axis()
					                .scale(axisScale)
					                .ticks(5)
					                .tickSize(-width - margin.left - margin.right)
					                .orient("left");

					            smallChartArea1.append("g")
					                .call(yAxis)
					                .attr("class", "ySmallFirst");

					            smallChartArea2.append("g")
					                .call(yAxis)
					                .attr("class", "ySmallAxis");

					            smallChartArea3.append("g")
					                .call(yAxis)
					                .attr("class", "ySmallAxis");

					            var xAxis = d3.svg.axis()
					                .scale(xScale)
					                .orient("bottom");							    	

										smallChartArea1.append("g")
					                .call(xAxis)
					                .attr("class", "xScatterAxis")		

										smallChartArea2.append("g")
					                .call(xAxis)
					                .attr("class", "xScatterAxis")

										smallChartArea3.append("g")
					                .call(xAxis)
					                .attr("class", "xScatterAxis")

								    	var bar = smallChartArea1.selectAll(".bar")
							          .data(nyData)
							          .enter().append("rect")
							          .attr("height", function(d) {return yScale(d.missed_votes);})
							          .attr("y", function(d) {return 300 - yScale(d.missed_votes);})
							          .attr("width", 4)
							          .attr("x", function(d,i) {return 5*i})
							          .attr("class","bar")
							          .classed("swing",function(d){return d.swing == "TRUE"});

								    	var alData = missed_votes_2013.filter(function(d){
								    			return d.state == "AL";
								    	});							    	

								    	var bar = smallChartArea2.selectAll(".bar")
							          .data(alData)
							          .enter().append("rect")
							          .attr("height", function(d) {return yScale(d.missed_votes);})
							          .attr("y", function(d) {return 300 - yScale(d.missed_votes);})
							          .attr("width", 4)
							          .attr("x", function(d,i) {return 5*i})
							          .attr("class","bar")
							          .classed("swing",function(d){return d.swing == "TRUE"});

								    	var flData = missed_votes_2013.filter(function(d){
								    			return d.state == "FL";
								    	});						    	

								    	var bar = smallChartArea3.selectAll(".bar")
							          .data(flData)
							          .enter().append("rect")
							          .attr("height", function(d) {return yScale(d.missed_votes);})
							          .attr("y", function(d) {return 300 - yScale(d.missed_votes);})
							          .attr("width", 4)
							          .attr("x", function(d,i) {return 5*i})
							          .attr("class","bar")
							          .classed("swing",function(d){return d.swing == "TRUE"});

											d3.selectAll(".franchiseLink")
							            .on("click", function(d) {
							              var idOfClickedLink = d3.select(this).attr("id");
							              updateLine(idOfClickedLink);
							          	// change the css a little so we know it's selected
							              d3.selectAll(".g-city-link").classed("selected-link", false);
							              d3.select(this).classed("selected-link", true)
							            });

							        function updateSmall3(state) {
              						var thisState = data.filter(function(d) { 
                							return d.state == state; 
              						});

              						d3.smallChart3.selectAll(".bar")
		              						.transition()
            					};

						    	};				    	

					      console.log(missed_votes_2013);
					      });

					</script>


			

	</div>
</body>
</html>